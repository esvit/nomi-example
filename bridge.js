(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
	typeof define === 'function' && define.amd ? define(['exports'], factory) :
	(global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.nomiBridge = {}));
})(this, (function (exports) { 'use strict';

	var commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};

	function createCommonjsModule(fn, module) {
		return module = { exports: {} }, fn(module, module.exports), module.exports;
	}

	createCommonjsModule((function(e){!function(t){if("undefined"!=typeof window){var n=!0,o=10,i="",r=0,a="",c=null,u="",s=!1,d={resize:1,click:1},l=128,f=!0,m=1,h="bodyOffset",g=h,p=!0,v="",y={},w=32,b=null,T=!1,E=!1,O="[iFrameSizer]",M=O.length,S="",I={max:1,min:1,bodyScroll:1,documentElementScroll:1},N="child",z=!0,A=window.parent,C="*",R=0,x=!1,k=null,L=16,F=1,j="scroll",P=j,D=window,H=function(){ce("onMessage function not defined");},W=function(){},q=function(){},B={height:function(){return ce("Custom height calculation function not defined"),document.documentElement.offsetHeight},width:function(){return ce("Custom width calculation function not defined"),document.body.scrollWidth}},J={},U=!1;try{var _=Object.create({},{passive:{get:function(){U=!0;}}});window.addEventListener("test",ne,_),window.removeEventListener("test",ne,_);}catch(e){}var V,X,Y,K,Q,G,Z,$={bodyOffset:function(){return document.body.offsetHeight+ye("marginTop")+ye("marginBottom")},offset:function(){return $.bodyOffset()},bodyScroll:function(){return document.body.scrollHeight},custom:function(){return B.height()},documentElementOffset:function(){return document.documentElement.offsetHeight},documentElementScroll:function(){return document.documentElement.scrollHeight},max:function(){return Math.max.apply(null,be($))},min:function(){return Math.min.apply(null,be($))},grow:function(){return $.max()},lowestElement:function(){return Math.max($.bodyOffset()||$.documentElementOffset(),we("bottom",Ee()))},taggedElement:function(){return Te("bottom","data-iframe-height")}},ee={bodyScroll:function(){return document.body.scrollWidth},bodyOffset:function(){return document.body.offsetWidth},custom:function(){return B.width()},documentElementScroll:function(){return document.documentElement.scrollWidth},documentElementOffset:function(){return document.documentElement.offsetWidth},scroll:function(){return Math.max(ee.bodyScroll(),ee.documentElementScroll())},max:function(){return Math.max.apply(null,be(ee))},min:function(){return Math.min.apply(null,be(ee))},rightMostElement:function(){return we("right",Ee())},taggedElement:function(){return Te("right","data-iframe-width")}},te=(V=Oe,Q=null,G=0,Z=function(){G=Date.now(),Q=null,K=V.apply(X,Y),Q||(X=Y=null);},function(){var e=Date.now();G||(G=e);var t=L-(e-G);return X=this,Y=arguments,t<=0||t>L?(Q&&(clearTimeout(Q),Q=null),G=e,K=V.apply(X,Y),Q||(X=Y=null)):Q||(Q=setTimeout(Z,t)),K});"iframeResizer"in window||(window.iframeChildListener=function(e){Ae({data:e,sameDomian:!0});},oe(window,"message",Ae),oe(window,"readystatechange",Ce),Ce());}function ne(){}function oe(e,t,n,o){e.addEventListener(t,n,!!U&&(o||{}));}function ie(e){return e.charAt(0).toUpperCase()+e.slice(1)}function re(e){return O+"["+S+"] "+e}function ae(e){T&&"object"==typeof window.console&&console.log(re(e));}function ce(e){"object"==typeof window.console&&console.warn(re(e));}function ue(){var e;!function(){function e(e){return "true"===e}var o=v.slice(M).split(":");S=o[0],r=t===o[1]?r:Number(o[1]),s=t===o[2]?s:e(o[2]),T=t===o[3]?T:e(o[3]),w=t===o[4]?w:Number(o[4]),n=t===o[6]?n:e(o[6]),a=o[7],g=t===o[8]?g:o[8],i=o[9],u=o[10],R=t===o[11]?R:Number(o[11]),y.enable=t!==o[12]&&e(o[12]),N=t===o[13]?N:o[13],P=t===o[14]?P:o[14],E=t===o[15]?E:e(o[15]);}(),ae("Initialising iFrame ("+window.location.href+")"),function(){function e(){var e=window.iFrameResizer;ae("Reading data from page: "+JSON.stringify(e)),Object.keys(e).forEach(se,e),H="onMessage"in e?e.onMessage:H,W="onReady"in e?e.onReady:W,C="targetOrigin"in e?e.targetOrigin:C,g="heightCalculationMethod"in e?e.heightCalculationMethod:g,P="widthCalculationMethod"in e?e.widthCalculationMethod:P;}function t(e,t){return "function"==typeof e&&(ae("Setup custom "+t+"CalcMethod"),B[t]=e,e="custom"),e}"iFrameResizer"in window&&Object===window.iFrameResizer.constructor&&(e(),g=t(g,"height"),P=t(P,"width"));ae("TargetOrigin for parent set to: "+C);}(),function(){t===a&&(a=r+"px");de("margin",function(e,t){-1!==t.indexOf("-")&&(ce("Negative CSS value ignored for "+e),t="");return t}("margin",a));}(),de("background",i),de("padding",u),(e=document.createElement("div")).style.clear="both",e.style.display="block",e.style.height="0",document.body.appendChild(e),he(),ge(),document.documentElement.style.height="",document.body.style.height="",ae('HTML & body height set to "auto"'),ae("Enable public methods"),D.parentIFrame={autoResize:function(e){return !0===e&&!1===n?(n=!0,pe()):!1===e&&!0===n&&(n=!1,fe("remove"),null!==c&&c.disconnect(),clearInterval(b)),ze(0,0,"autoResize",JSON.stringify(n)),n},close:function(){ze(0,0,"close");},getId:function(){return S},getPageInfo:function(e){"function"==typeof e?(q=e,ze(0,0,"pageInfo")):(q=function(){},ze(0,0,"pageInfoStop"));},moveToAnchor:function(e){y.findTarget(e);},reset:function(){Ne("parentIFrame.reset");},scrollTo:function(e,t){ze(t,e,"scrollTo");},scrollToOffset:function(e,t){ze(t,e,"scrollToOffset");},sendMessage:function(e,t){ze(0,0,"message",JSON.stringify(e),t);},setHeightCalculationMethod:function(e){g=e,he();},setWidthCalculationMethod:function(e){P=e,ge();},setTargetOrigin:function(e){ae("Set targetOrigin: "+e),C=e;},size:function(e,t){Me("size","parentIFrame.size("+(e||"")+(t?","+t:"")+")",e,t);}},function(){if(!0!==E)return;function e(e){ze(0,0,e.type,e.screenY+":"+e.screenX);}function t(t,n){ae("Add event listener: "+n),oe(window.document,t,e);}t("mouseenter","Mouse Enter"),t("mouseleave","Mouse Leave");}(),pe(),y=function(){function e(){return {x:window.pageXOffset===t?document.documentElement.scrollLeft:window.pageXOffset,y:window.pageYOffset===t?document.documentElement.scrollTop:window.pageYOffset}}function n(t){var n=t.getBoundingClientRect(),o=e();return {x:parseInt(n.left,10)+parseInt(o.x,10),y:parseInt(n.top,10)+parseInt(o.y,10)}}function o(e){function o(e){var t=n(e);ae("Moving to in page link (#"+i+") at x: "+t.x+" y: "+t.y),ze(t.y,t.x,"scrollToOffset");}var i=e.split("#")[1]||e,r=decodeURIComponent(i),a=document.getElementById(r)||document.getElementsByName(r)[0];t===a?(ae("In page link (#"+i+") not found in iFrame, so sending to parent"),ze(0,0,"inPageLink","#"+i)):o(a);}function i(){var e=window.location.hash,t=window.location.href;""!==e&&"#"!==e&&o(t);}function r(){function e(e){function t(e){e.preventDefault(),o(this.getAttribute("href"));}"#"!==e.getAttribute("href")&&oe(e,"click",t);}Array.prototype.forEach.call(document.querySelectorAll('a[href^="#"]'),e);}function a(){oe(window,"hashchange",i);}function c(){setTimeout(i,l);}function u(){Array.prototype.forEach&&document.querySelectorAll?(ae("Setting up location.hash handlers"),r(),a(),c()):ce("In page linking not fully supported in this browser! (See README.md for IE8 workaround)");}y.enable?u():ae("In page linking not enabled");return {findTarget:o}}(),Me("init","Init message from host page"),W();}function se(e){var t=e.split("Callback");if(2===t.length){var n="on"+t[0].charAt(0).toUpperCase()+t[0].slice(1);this[n]=this[e],delete this[e],ce("Deprecated: '"+e+"' has been renamed '"+n+"'. The old method will be removed in the next major version.");}}function de(e,n){t!==n&&""!==n&&"null"!==n&&(document.body.style[e]=n,ae("Body "+e+' set to "'+n+'"'));}function le(e){var t={add:function(t){function n(){Me(e.eventName,e.eventType);}J[t]=n,oe(window,t,n,{passive:!0});},remove:function(e){var t,n,o,i=J[e];delete J[e],t=window,n=e,o=i,t.removeEventListener(n,o,!1);}};e.eventNames&&Array.prototype.map?(e.eventName=e.eventNames[0],e.eventNames.map(t[e.method])):t[e.method](e.eventName),ae(ie(e.method)+" event listener: "+e.eventType);}function fe(e){le({method:e,eventType:"Animation Start",eventNames:["animationstart","webkitAnimationStart"]}),le({method:e,eventType:"Animation Iteration",eventNames:["animationiteration","webkitAnimationIteration"]}),le({method:e,eventType:"Animation End",eventNames:["animationend","webkitAnimationEnd"]}),le({method:e,eventType:"Input",eventName:"input"}),le({method:e,eventType:"Mouse Up",eventName:"mouseup"}),le({method:e,eventType:"Mouse Down",eventName:"mousedown"}),le({method:e,eventType:"Orientation Change",eventName:"orientationchange"}),le({method:e,eventType:"Print",eventNames:["afterprint","beforeprint"]}),le({method:e,eventType:"Ready State Change",eventName:"readystatechange"}),le({method:e,eventType:"Touch Start",eventName:"touchstart"}),le({method:e,eventType:"Touch End",eventName:"touchend"}),le({method:e,eventType:"Touch Cancel",eventName:"touchcancel"}),le({method:e,eventType:"Transition Start",eventNames:["transitionstart","webkitTransitionStart","MSTransitionStart","oTransitionStart","otransitionstart"]}),le({method:e,eventType:"Transition Iteration",eventNames:["transitioniteration","webkitTransitionIteration","MSTransitionIteration","oTransitionIteration","otransitioniteration"]}),le({method:e,eventType:"Transition End",eventNames:["transitionend","webkitTransitionEnd","MSTransitionEnd","oTransitionEnd","otransitionend"]}),"child"===N&&le({method:e,eventType:"IFrame Resized",eventName:"resize"});}function me(e,t,n,o){return t!==e&&(e in n||(ce(e+" is not a valid option for "+o+"CalculationMethod."),e=t),ae(o+' calculation method set to "'+e+'"')),e}function he(){g=me(g,h,$,"height");}function ge(){P=me(P,j,ee,"width");}function pe(){var e;!0===n?(fe("add"),e=0>w,window.MutationObserver||window.WebKitMutationObserver?e?ve():c=function(){function e(e){function t(e){!1===e.complete&&(ae("Attach listeners to "+e.src),e.addEventListener("load",i,!1),e.addEventListener("error",r,!1),u.push(e));}"attributes"===e.type&&"src"===e.attributeName?t(e.target):"childList"===e.type&&Array.prototype.forEach.call(e.target.querySelectorAll("img"),t);}function t(e){u.splice(u.indexOf(e),1);}function n(e){ae("Remove listeners from "+e.src),e.removeEventListener("load",i,!1),e.removeEventListener("error",r,!1),t(e);}function o(e,t,o){n(e.target),Me(t,o+": "+e.target.src);}function i(e){o(e,"imageLoad","Image loaded");}function r(e){o(e,"imageLoadFailed","Image load failed");}function a(t){Me("mutationObserver","mutationObserver: "+t[0].target+" "+t[0].type),t.forEach(e);}function c(){var e=document.querySelector("body"),t={attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0};return d=new s(a),ae("Create body MutationObserver"),d.observe(e,t),d}var u=[],s=window.MutationObserver||window.WebKitMutationObserver,d=c();return {disconnect:function(){"disconnect"in d&&(ae("Disconnect body MutationObserver"),d.disconnect(),u.forEach(n));}}}():(ae("MutationObserver not supported in this browser!"),ve())):ae("Auto Resize disabled");}function ve(){0!==w&&(ae("setInterval: "+w+"ms"),b=setInterval((function(){Me("interval","setInterval: "+w);}),Math.abs(w)));}function ye(e,t){var n=0;return t=t||document.body,n=null===(n=document.defaultView.getComputedStyle(t,null))?0:n[e],parseInt(n,o)}function we(e,t){for(var n=t.length,o=0,i=0,r=ie(e),a=Date.now(),c=0;c<n;c++)(o=t[c].getBoundingClientRect()[e]+ye("margin"+r,t[c]))>i&&(i=o);return a=Date.now()-a,ae("Parsed "+n+" HTML elements"),ae("Element position calculated in "+a+"ms"),function(e){e>L/2&&ae("Event throttle increased to "+(L=2*e)+"ms");}(a),i}function be(e){return [e.bodyOffset(),e.bodyScroll(),e.documentElementOffset(),e.documentElementScroll()]}function Te(e,t){var n=document.querySelectorAll("["+t+"]");return 0===n.length&&(ce("No tagged elements ("+t+") found on page"),document.querySelectorAll("body *")),we(e,n)}function Ee(){return document.querySelectorAll("body *")}function Oe(e,n,o,i){var r,a;!function(){function e(e,t){return !(Math.abs(e-t)<=R)}return r=t===o?$[g]():o,a=t===i?ee[P]():i,e(m,r)||s&&e(F,a)}()&&"init"!==e?!(e in{init:1,interval:1,size:1})&&(g in I||s&&P in I)?Ne(n):e in{interval:1}||ae("No change in size detected"):(Se(),ze(m=r,F=a,e));}function Me(e,t,n,o){x&&e in d?ae("Trigger event cancelled: "+e):(e in{reset:1,resetPage:1,init:1}||ae("Trigger event: "+t),"init"===e?Oe(e,t,n,o):te(e,t,n,o));}function Se(){x||(x=!0,ae("Trigger event lock on")),clearTimeout(k),k=setTimeout((function(){x=!1,ae("Trigger event lock off"),ae("--");}),l);}function Ie(e){m=$[g](),F=ee[P](),ze(m,F,e);}function Ne(e){var t=g;g=h,ae("Reset trigger event: "+e),Se(),Ie("reset"),g=t;}function ze(e,n,o,i,r){var a;!0===z&&(t===r?r=C:ae("Message targetOrigin: "+r),ae("Sending message to host page ("+(a=S+":"+e+":"+n+":"+o+(t===i?"":":"+i))+")"),A.postMessage(O+a,r));}function Ae(n){var o={init:function(){v=n.data,A=n.source,ue(),f=!1,setTimeout((function(){p=!1;}),l);},reset:function(){p?ae("Page reset ignored by init"):(ae("Page size reset by host page"),Ie("resetPage"));},resize:function(){Me("resizeParent","Parent window requested size check");},moveToAnchor:function(){y.findTarget(r());},inPageLink:function(){this.moveToAnchor();},pageInfo:function(){var e=r();ae("PageInfoFromParent called from parent: "+e),q(JSON.parse(e)),ae(" --");},message:function(){var e=r();ae("onMessage called from parent: "+e),H(JSON.parse(e)),ae(" --");}};function i(){return n.data.split("]")[1].split(":")[0]}function r(){return n.data.slice(n.data.indexOf(":")+1)}function a(){return n.data.split(":")[2]in{true:1,false:1}}function c(){var r=i();r in o?o[r]():!e.exports&&"iFrameResize"in window||window.jQuery!==t&&"iFrameResize"in window.jQuery.prototype||a()||ce("Unexpected message ("+n.data+")");}O===(""+n.data).slice(0,M)&&(!1===f?c():a()?o.init():ae('Ignored message of type "'+i()+'". Received before initialization.'));}function Ce(){"loading"!==document.readyState&&window.parent.postMessage("[iFrameResizerChild]Ready","*");}}();}));

	var version="0.1.0";

	var EPostCommands;!function(o){o.Invoke="invoke",o.OpenModal="openModal",o.CloseModal="closeModal",o.SetModalPayload="setModalPayload",o.PushRoute="pushRoute";}(EPostCommands||(EPostCommands={}));var EPostChildCommands;!function(o){o.ModalButtonClick="modalButtonClick",o.UpdateUrl="updateUrl",o.SetTheme="setTheme",o.SetLocale="setLocale";}(EPostChildCommands||(EPostChildCommands={}));const USER_AGENT=`ITFin App Bridge (${version})`;

	function getRandomId(){return Math.random().toString(36).substring(2)}

	class Modal{constructor(t,s,i){this._bridge=t,this._url=s,this._params=i,this._id="",this._isOpened=!1,this._id=getRandomId();const o=this._params?.buttons||[];o.length||o.push({text:"Close"}),this._buttons=o.map(((t,s)=>({...t,id:`${this._id}:${s}`})));}get id(){return this._id}get isOpened(){return this._isOpened}open(){const t=this._params||{},s=this._buttons;return this._isOpened=!0,this._bridge.sendCommand(EPostCommands.OpenModal,{id:this._id,url:this._url,params:{...t,buttons:s}})}close(){return this._isOpened=!1,this._bridge.sendCommand(EPostCommands.CloseModal,{id:this._id})}clickButton(t,s){const i=this._buttons.find((s=>s.id===t));if(!i)throw new Error(`Button ${t} not found`);i.onClick&&i.onClick(s),this.close();}}

	class PropertyBag{constructor(e,t){this._appSlug=e,this._request=t,this._endpointPrefix=`/api/v3/apps/${e}/property-bag`;}async get(e){const{data:t}=await this._request.get(`${this._endpointPrefix}/${e}`,{json:!0,signed:!0});return t.value}async set(e,t){await this._request.post(`${this._endpointPrefix}/${e}`,{value:t},{json:!0,signed:!0});}async remove(e){await this._request.delete(`${this._endpointPrefix}/${e}`,{signed:!0});}}

	var browserPonyfill=createCommonjsModule((function(e,t){var r="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==commonjsGlobal&&commonjsGlobal,o=function(){function e(){this.fetch=!1,this.DOMException=r.DOMException;}return e.prototype=r,new e}();!function(e){!function(t){var r=void 0!==e&&e||"undefined"!=typeof self&&self||void 0!==r&&r,o="URLSearchParams"in r,n="Symbol"in r&&"iterator"in Symbol,s="FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch(e){return !1}}(),i="FormData"in r,a="ArrayBuffer"in r;if(a)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(e){return e&&f.indexOf(Object.prototype.toString.call(e))>-1};function u(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function c(e){return "string"!=typeof e&&(e=String(e)),e}function l(e){var t={next:function(){var t=e.shift();return {done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach((function(e,t){this.append(t,e);}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1]);}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t]);}),this);}function y(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0;}function p(e){return new Promise((function(t,r){e.onload=function(){t(e.result);},e.onerror=function(){r(e.error);};}))}function b(e){var t=new FileReader,r=p(t);return t.readAsArrayBuffer(e),r}function m(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function w(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:s&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:o&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():a&&s&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=m(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a&&(ArrayBuffer.prototype.isPrototypeOf(e)||h(e))?this._bodyArrayBuffer=m(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):o&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"));},s&&(this.blob=function(){var e=y(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=y(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(b)}),this.text=function(){var e,t,r,o=y(this);if(o)return o;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=p(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),o=0;o<t.length;o++)r[o]=String.fromCharCode(t[o]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(E)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=u(e),t=c(t);var r=this.map[e];this.map[e]=r?r+", "+t:t;},d.prototype.delete=function(e){delete this.map[u(e)];},d.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},d.prototype.set=function(e,t){this.map[u(e)]=c(t);},d.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this);},d.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r);})),l(e)},d.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t);})),l(e)},d.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t]);})),l(e)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function _(e,t){if(!(this instanceof _))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,o,n=(t=t||{}).body;if(e instanceof _){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0);}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=(r=t.method||this.method||"GET",o=r.toUpperCase(),v.indexOf(o)>-1?o:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(n),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var s=/([?&])_=[^&]*/;if(s.test(this.url))this.url=this.url.replace(s,"$1_="+(new Date).getTime());else {this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime();}}}function E(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),o=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(o),decodeURIComponent(n));}})),t}function T(e,t){if(!(this instanceof T))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e);}_.prototype.clone=function(){return new _(this,{body:this._bodyInit})},w.call(_.prototype),w.call(T.prototype),T.prototype.clone=function(){return new T(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},T.error=function(){var e=new T(null,{status:0,statusText:""});return e.type="error",e};var x=[301,302,303,307,308];T.redirect=function(e,t){if(-1===x.indexOf(t))throw new RangeError("Invalid status code");return new T(null,{status:t,headers:{location:e}})},t.DOMException=r.DOMException;try{new t.DOMException;}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack;},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException;}function A(e,o){return new Promise((function(n,i){var f=new _(e,o);if(f.signal&&f.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var h=new XMLHttpRequest;function u(){h.abort();}h.onload=function(){var e,t,r={status:h.status,statusText:h.statusText,headers:(e=h.getAllResponseHeaders()||"",t=new d,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),o=r.shift().trim();if(o){var n=r.join(":").trim();t.append(o,n);}})),t)};r.url="responseURL"in h?h.responseURL:r.headers.get("X-Request-URL");var o="response"in h?h.response:h.responseText;setTimeout((function(){n(new T(o,r));}),0);},h.onerror=function(){setTimeout((function(){i(new TypeError("Network request failed"));}),0);},h.ontimeout=function(){setTimeout((function(){i(new TypeError("Network request failed"));}),0);},h.onabort=function(){setTimeout((function(){i(new t.DOMException("Aborted","AbortError"));}),0);},h.open(f.method,function(e){try{return ""===e&&r.location.href?r.location.href:e}catch(t){return e}}(f.url),!0),"include"===f.credentials?h.withCredentials=!0:"omit"===f.credentials&&(h.withCredentials=!1),"responseType"in h&&(s?h.responseType="blob":a&&f.headers.get("Content-Type")&&-1!==f.headers.get("Content-Type").indexOf("application/octet-stream")&&(h.responseType="arraybuffer")),!o||"object"!=typeof o.headers||o.headers instanceof d?f.headers.forEach((function(e,t){h.setRequestHeader(t,e);})):Object.getOwnPropertyNames(o.headers).forEach((function(e){h.setRequestHeader(e,c(o.headers[e]));})),f.signal&&(f.signal.addEventListener("abort",u),h.onreadystatechange=function(){4===h.readyState&&f.signal.removeEventListener("abort",u);}),h.send(void 0===f._bodyInit?null:f._bodyInit);}))}A.polyfill=!0,r.fetch||(r.fetch=A,r.Headers=d,r.Request=_,r.Response=T),t.Headers=d,t.Request=_,t.Response=T,t.fetch=A;}({});}(o),o.fetch.ponyfill=!0,delete o.fetch.polyfill;var n=r.fetch?r:o;(t=n.fetch).default=n.fetch,t.fetch=n.fetch,t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response,e.exports=t;}));browserPonyfill.fetch;browserPonyfill.Headers;browserPonyfill.Request;browserPonyfill.Response;

	class Request{constructor(t,e){this._endpointUrl=t,this._jwtToken=e;}get(t,e){return this._runMethod("get",t,e)}post(t,e,s){return this._runMethod("post",t,e,s)}put(t,e,s){return this._runMethod("put",t,e,s)}patch(t,e,s){return this._runMethod("patch",t,e,s)}delete(t,e){return this._runMethod("delete",t,e)}async _runMethod(t,e,s,r){const n=new URL(e,this._endpointUrl),o=r||s||{},a=r||["put","post"].includes(t)?s:void 0;a&&(o.body=JSON.stringify(a)),o.method=t,o.headers=o.headers||{},o.headers["user-agent"]=USER_AGENT,o.signed&&this._jwtToken&&(o.headers["x-app-token"]=`Bearer ${this._jwtToken}`),o.json&&(o.headers["content-type"]="application/json; charset=utf-8");const h=await browserPonyfill(n.toString(),o),u=204===h.status?null:await h.json();if(h.status>=300){const t=new Error(`Request error: ${h.statusText}`);throw t.status=h.status,t.headers=h.headers,t.response=u,t}return {headers:h.headers,data:u,status:h.status,statusText:h.statusText}}}

	class Bridge{constructor(){this._modals=[],this._routeUrl="/",this._context=null,"undefined"!=typeof window&&window.addEventListener("message",(({data:t})=>{try{const e=JSON.parse(t);e.frameId===this._frameId&&this.onIncomeMessage(e);}catch(t){}}));}onIncomeMessage({command:t,...e}){switch(t){case EPostChildCommands.ModalButtonClick:const{id:t,buttonId:o,payload:n}=e,s=this._modals.find((e=>e.id===t));if(!s)throw new Error(`Modal ${t} not found`);s.clickButton(o,n);break;case EPostChildCommands.UpdateUrl:const{url:r}=e;if(this._context){this._context.url=r;const t=new Event("bridge:routeChange");t.url=r,console.info("routeChange",r),window.dispatchEvent(t);}break;case EPostChildCommands.SetTheme:const{theme:i}=e;if(this._context){this._context.theme=i;const t=new Event("bridge:themeChange");t.theme=i,window.dispatchEvent(t),this.theme=i;}break;case EPostChildCommands.SetLocale:const{locale:a}=e;if(this._context){this._context.locale=a;const t=new Event("bridge:localeChange");t.locale=a,window.dispatchEvent(t),this.locale=a;}}}get locale(){return this._context?.locale||"en_US"}set locale(t){this._context&&(this._context.locale=t),document.documentElement.lang=t.replace("_","-");}get theme(){return this._context?.theme||"light"}set theme(t){this._context&&(this._context.theme=t),setTimeout((()=>{document.body.setAttribute("data-theme",t),document.body.setAttribute("data-bs-theme",t);}),10);}get frameId(){return this._frameId}get context(){return this._context}getFullUrl(t){return this._baseUrl?new URL(t,this._baseUrl).toString():t}sendCommand(t,e){window.parent.postMessage(JSON.stringify({frameId:this._frameId,command:t,...e}),"*");}invoke(t,e){return this.sendCommand(EPostCommands.Invoke,{method:t,params:e})}openModal(t,e){const o=new Modal(this,this.getFullUrl(t),e);this._modals.push(o),o.open();}initContextFromSearchParams(t,e){let o=new URLSearchParams(t);if(o.get("__nomiContext")||(o=new URLSearchParams(e.substring(1))),o.get("__nomiContext"))try{if(this._context=JSON.parse(o.get("__nomiContext")||"{}"),!this._context)throw new Error("Invalid context");this._baseUrl=new URL(this._context.frameUrl),this._routeUrl=this._context.url||"/",this._frameId=this._context.frameId,this._request=new Request(this._context.endpointUrl,this._context.token),this._propertyBag=new PropertyBag(this._context.applicationSlug,this._request),this._context.theme&&(this.theme=this._context.theme),this._context.locale&&(this.locale=this._context.locale);}catch(t){}}setModalPayload(t){if(!this._context?.modalId)throw new Error("modalId is not set");this.sendCommand(EPostCommands.SetModalPayload,{id:this._context.modalId,payload:t});}getRouteUrl(){return this._routeUrl}pushRoute(t){this._routeUrl=t,this.sendCommand(EPostCommands.PushRoute,{url:t});}getVariable(t){if(!this._propertyBag)throw new Error("PropertyBag is not initialized");return this._propertyBag.get(t)}setVariable(t,e){if(!this._propertyBag)throw new Error("PropertyBag is not initialized");return this._propertyBag.set(t,e)}deleteVariable(t){if(!this._propertyBag)throw new Error("PropertyBag is not initialized");return this._propertyBag.remove(t)}get request(){return this._request}}

	const callbacks=[];exports.isReady=!1;function ready(e){exports.isReady?e(bridge):callbacks.push(e);}const bridge=new Bridge;if("undefined"!=typeof location){bridge.initContextFromSearchParams(location.search,location.hash);for(const e of callbacks)e(bridge);exports.isReady=!0;}function getContext(){return bridge.context}function openModal(e,t){return bridge.openModal(e,t)}function setModalPayload(e){return bridge.setModalPayload(e)}function pushRoute(e){return bridge.pushRoute(e)}function getRouteUrl(){return bridge.getRouteUrl()}function getVariable(e){return bridge.getVariable(e)}function setVariable(e,t){return bridge.setVariable(e,t)}function deleteVariable(e){return bridge.deleteVariable(e)}function request(e,t,r,o){return bridge.request?._runMethod(e,t,r,o)}async function invoke(e,t,r,o,i){const n=`/api/v3/apps/invoke/${e}${r}`,a=await(bridge.request?._runMethod("post",n,{method:t,url:r,data:o},{json:!0,signed:!0,...i}));return a?a.data:void 0}

	exports.deleteVariable = deleteVariable;
	exports.getContext = getContext;
	exports.getRouteUrl = getRouteUrl;
	exports.getVariable = getVariable;
	exports.invoke = invoke;
	exports.openModal = openModal;
	exports.pushRoute = pushRoute;
	exports.ready = ready;
	exports.request = request;
	exports.setModalPayload = setModalPayload;
	exports.setVariable = setVariable;

}));
